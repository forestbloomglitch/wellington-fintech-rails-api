{
  "name": "Wellington FinTech Rails API",
  "image": "mcr.microsoft.com/devcontainers/ruby:1-3.1-bullseye",

  "features": {
    "ghcr.io/devcontainers/features/node:1": {
      "version": "18"
    },
    "ghcr.io/devcontainers/features/git:1": {}
  },

  "services": {
    "postgres": {
      "image": "postgres:15",
      "restart": "unless-stopped",
      "environment": {
        "POSTGRES_PASSWORD": "wellington",
        "POSTGRES_USER": "wellington",
        "POSTGRES_DB": "wellington_fintech_development"
      },
      "volumes": [
        "postgres-data:/var/lib/postgresql/data"
      ],
      "ports": [
        "5432:5432"
      ]
    },
    "redis": {
      "image": "redis:7-alpine",
      "restart": "unless-stopped",
      "ports": [
        "6379:6379"
      ]
    }
  },

  "forwardPorts": [3000, 5432, 6379],
  "portsAttributes": {
    "3000": {
      "label": "Rails API Server",
      "onAutoForward": "openPreview"
    },
    "5432": {
      "label": "PostgreSQL"
    },
    "6379": {
      "label": "Redis"
    }
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "rebornix.ruby",
        "koichisasada.vscode-rdbg",
        "castwide.solargraph",
        "bradlc.vscode-tailwindcss",
        "ms-vscode.vscode-json",
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "ms-vsliveshare.vsliveshare",
        "formulahendry.auto-rename-tag",
        "bradlc.vscode-tailwindcss",
        "heybourn.headwind",
        "ms-vscode.vscode-typescript-next"
      ],
      "settings": {
        "ruby.intellisense": "rubyLsp",
        "ruby.format": "rubocop",
        "ruby.lint": {
          "rubocop": {
            "useBundler": true
          }
        },
        "editor.formatOnSave": true,
        "editor.tabSize": 2,
        "files.insertFinalNewline": true,
        "files.trimTrailingWhitespace": true
      }
    }
  },

  "postCreateCommand": "bash .devcontainer/setup.sh",

  "remoteEnv": {
    "RAILS_ENV": "development",
    "DATABASE_URL": "postgresql://wellington:wellington@postgres:5432/wellington_fintech_development",
    "REDIS_URL": "redis://redis:6379/0",
    "DATABASE_USER": "wellington",
    "DATABASE_PASSWORD": "wellington",
    "DATABASE_HOST": "postgres",
    "DATABASE_PORT": "5432"
  },

  "remoteUser": "vscode",

  "workspaceFolder": "/workspaces/wellington-fintech-rails-api"
}